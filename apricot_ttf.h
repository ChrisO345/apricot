#ifndef APRICOT_TTF_C_
#define APRICOT_TTF_C_

#ifndef APRICOT_TTF_DEF
#define APRICOT_TTF_DEF extern
#endif

#define APRICOT_TTF_W 5
#define APRICOT_TTF_H 6

static unsigned char apricot_default_glyphs[128][APRICOT_TTF_H][APRICOT_TTF_W];
typedef struct {
  const unsigned char *glyphs;
  int width;
  int height;
} ApricotFont;

APRICOT_TTF_DEF void apricot_draw_char(const ApricotCanvas *canvas,
                                       const ApricotFont *font, char ch, int x,
                                       int y, ApricotColor color);

APRICOT_TTF_DEF void apricot_draw_text(const ApricotCanvas *canvas,
                                       const ApricotFont *font,
                                       const char *text, int x, int y,
                                       ApricotColor color);

static int apricot_glyph_scale = 1;
APRICOT_TTF_DEF void apricot_set_glyph_scale(int scale);

#endif /* APRICOT_TTF_C_ */

#ifdef APRICOT_IMPLEMENTATION

APRICOT_TTF_DEF void apricot_draw_char(const ApricotCanvas *canvas,
                                       const ApricotFont *font, char ch, int x,
                                       int y, ApricotColor color) {
  if ((unsigned char)ch >= 128)
    return;

  const unsigned char *glyph = font->glyphs + (ch * font->width * font->height);

  size_t S = apricot_glyph_scale;

  for (int row = 0; row < font->height; row++) {
    for (int col = 0; col < font->width; col++) {

      int pixel = glyph[row * font->width + col];
      if (!pixel)
        continue;

      // Scaled pixel region
      int base_x = x + col * S;
      int base_y = y + row * S;

      // Fill SxS block
      for (size_t dy = 0; dy < S; dy++) {
        for (size_t dx = 0; dx < S; dx++) {

          int px = base_x + dx;
          int py = base_y + dy;

          if (px >= 0 && px < (int)canvas->width && py >= 0 &&
              py < (int)canvas->height) {
            APRICOT_SET_PIXEL(canvas, px, py, color);
          }
        }
      }
    }
  }
}

APRICOT_TTF_DEF void apricot_draw_text(const ApricotCanvas *canvas,
                                       const ApricotFont *font,
                                       const char *text, int x, int y,
                                       ApricotColor color) {
  size_t S = apricot_glyph_scale;
  int cx = x;

  while (*text) {
    apricot_draw_char(canvas, font, *text, cx, y, color);
    cx += (font->width * S) + S; // scaled spacing
    text++;
  }
}

APRICOT_TTF_DEF void apricot_set_glyph_scale(int scale) {
  apricot_glyph_scale = scale;
  if (apricot_glyph_scale < 1)
    apricot_glyph_scale = 1;
}

static unsigned char apricot_default_glyphs[128][APRICOT_TTF_H][APRICOT_TTF_W] =
    {
        ['a'] =
            {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
            },
        ['b'] =
            {
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 0, 0},
            },
        ['c'] =
            {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['d'] =
            {
                {0, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
            },
        ['e'] =
            {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 1, 0},
                {1, 0, 0, 0, 0},
                {0, 1, 1, 1, 0},
            },
        ['f'] =
            {
                {0, 0, 1, 1, 0},
                {0, 1, 0, 0, 0},
                {1, 1, 1, 1, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
            },
        ['g'] =
            {
                {0, 1, 1, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['h'] =
            {
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
            },
        ['i'] =
            {
                {0, 0, 1, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
            },
        ['j'] =
            {
                {0, 0, 1, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {1, 0, 1, 0, 0},
                {0, 1, 1, 0, 0},
            },
        ['k'] =
            {
                {1, 0, 0, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 1, 0, 0},
                {1, 1, 0, 0, 0},
                {1, 0, 1, 0, 0},
                {1, 0, 0, 1, 0},
            },
        ['l'] =
            {
                {0, 1, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 1, 1, 1, 0},
            },
        ['m'] =
            {
                {0, 0, 0, 0, 0},
                {0, 1, 0, 1, 1},
                {1, 0, 1, 0, 1},
                {1, 0, 1, 0, 1},
                {1, 0, 1, 0, 1},
                {1, 0, 1, 0, 1},
            },
        ['n'] =
            {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
            },
        ['o'] =
            {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['p'] =
            {
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 0, 0},
            },
        ['q'] =
            {
                {0, 1, 1, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 0, 0, 1, 0},
            },
        ['r'] =
            {
                {0, 0, 0, 0, 0},
                {1, 0, 1, 1, 0},
                {1, 1, 0, 0, 1},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 0, 0, 0, 0},
            },
        ['s'] =
            {
                {0, 0, 0, 0, 0},
                {0, 1, 1, 1, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {1, 1, 1, 0, 0},
            },
        ['t'] =
            {
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
                {1, 1, 1, 1, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['u'] =
            {
                {0, 0, 0, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
            },
        ['v'] =
            {
                {0, 0, 0, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['w'] =
            {
                {0, 0, 0, 0, 0},
                {1, 0, 0, 0, 1},
                {1, 0, 1, 0, 1},
                {1, 0, 1, 0, 1},
                {1, 0, 1, 0, 1},
                {0, 1, 1, 1, 1},
            },
        ['x'] =
            {
                {0, 0, 0, 0, 0},
                {1, 0, 1, 0, 0},
                {1, 0, 1, 0, 0},
                {0, 1, 0, 0, 0},
                {1, 0, 1, 0, 0},
                {1, 0, 1, 0, 0},
            },
        ['y'] =
            {
                {0, 0, 0, 0, 0},
                {1, 0, 1, 0, 0},
                {1, 0, 1, 0, 0},
                {1, 0, 1, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
            },
        ['z'] =
            {
                {0, 0, 0, 0, 0},
                {1, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 1, 0},
            },

        ['0'] =
            {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['1'] =
            {
                {0, 0, 1, 0, 0},
                {0, 1, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 1, 0, 0},
                {0, 1, 1, 1, 0},
            },
        ['2'] =
            {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 1, 0},
            },
        ['3'] =
            {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 0, 1, 0, 0},
                {0, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['4'] =
            {
                {0, 0, 1, 1, 0},
                {0, 1, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {1, 1, 1, 1, 1},
                {0, 0, 0, 1, 0},
                {0, 0, 0, 1, 0},
            },
        ['5'] =
            {
                {1, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {0, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['6'] =
            {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 0, 0},
                {1, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['7'] =
            {
                {1, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 0, 1, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
                {0, 1, 0, 0, 0},
            },
        ['8'] =
            {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        ['9'] =
            {
                {0, 1, 1, 0, 0},
                {1, 0, 0, 1, 0},
                {1, 0, 0, 1, 0},
                {0, 1, 1, 1, 0},
                {0, 0, 0, 1, 0},
                {0, 1, 1, 0, 0},
            },
        [','] =
            {
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 1, 0},
                {0, 0, 1, 0, 0},
            },
        ['.'] =
            {
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 1, 0, 0},
            },
        ['-'] =
            {
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
                {1, 1, 1, 1, 0},
                {0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0},
            },
};

#endif /* APRICOT_IMPLEMENTATION */
